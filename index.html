<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Heart</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: #111;
}
canvas { display: block; }
#message {
  position: absolute;
  top: 50%;
  width: 100%;
  text-align: center;
  font-size: 40px;
  color: #fff;
  opacity: 0;
  transform: translateY(-50%);
  letter-spacing: 2px;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="message">С Днём Святого Валентина!</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const centerX = canvas.width/2;
const centerY = canvas.height/2;

const settings = {
  numParticles: 500,
  pulseSpeed: 0.05,
  scale: 15,
  colorStart: [255,255,255],
  colorEnd: [255,182,193],
  sparkleChance: 0.05
};

let pulseTime = 0;
let particles = [];

// формула сердца
function getHeartPoint(t, scale = settings.scale) {
  const x = scale*16*Math.pow(Math.sin(t),3);
  const y = -scale*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
  return {x,y};
}

// создаем частицы
class Particle {
  constructor() {
    this.reset();
  }
  reset() {
    const t = Math.random()*Math.PI*2;
    const point = getHeartPoint(t);
    this.targetX = centerX + point.x;
    this.targetY = centerY + point.y;
    this.x = this.targetX + (Math.random()-0.5)*200;
    this.y = this.targetY + (Math.random()-0.5)*200;
    this.vx = 0;
    this.vy = 0;
    this.size = Math.random()*2+1;
    this.life = 1;
    this.sparkle = Math.random()<settings.sparkleChance;
  }
  update() {
    // пульсация "дыхание"
    const dx = this.targetX - this.x + Math.sin(pulseTime+this.x*0.01)*5;
    const dy = this.targetY - this.y + Math.cos(pulseTime+this.y*0.01)*5;
    this.vx += dx*0.01;
    this.vy += dy*0.01;
    this.vx *= 0.9;
    this.vy *= 0.9;
    this.x += this.vx;
    this.y += this.vy;

    // уменьшение жизни для эффекта рассыпания
    this.life -= 0.001;
    if(this.life<=0)this.reset();
  }
  draw() {
    const t = (Math.sin(pulseTime + this.x*0.01)+1)/2;
    const c = settings.colorStart.map((v,i)=>v+(settings.colorEnd[i]-v)*t);
    ctx.fillStyle=`rgba(${Math.floor(c[0])},${Math.floor(c[1])},${Math.floor(c[2])},${this.life})`;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
  }
}

for(let i=0;i<settings.numParticles;i++)particles.push(new Particle());

// анимация
function animate(){
  pulseTime+=settings.pulseSpeed;
  ctx.fillStyle="rgba(17,17,17,0.25)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  particles.forEach(p=>{
    p.update();
    p.draw();
  });

  requestAnimationFrame(animate);
}

animate();

// текст появляется плавно после 1 сек
setTimeout(()=>{
  document.getElementById('message').style.opacity=1;
},1000);

window.addEventListener('resize',()=>{
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
});
</script>
</body>
</html>
