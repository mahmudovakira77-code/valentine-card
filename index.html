<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Animated Heart</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: #111;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
canvas { display: block; }
#message {
  position: absolute;
  top: 50%;
  width: 100%;
  text-align: center;
  font-size: 40px;
  color: #fff;
  opacity: 0;
  transform: translateY(-50%);
  letter-spacing: 2px;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="message">С Днём Святого Валентина!</div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let centerX = canvas.width/2;
let centerY = canvas.height/2;
let pulseTime = 0;

const settings = {
  numParticles: 5000,
  pulseSpeed: 0.05,
  scale: 15,
  colorStart: [255,255,255],
  colorEnd: [255,182,193],
  sparkleChance: 0.05,
  text: "С Днём Святого Валентина!",
  textColor: "#ffffff"
};

let heartPoints = [];
let particles = [];
let trails = [];

function generateHeartShape() {
  heartPoints = [];
  const pulse = 1 + Math.sin(pulseTime) * 0.05;
  const scale = settings.scale * pulse;
  const steps = Math.max(40, settings.numParticles);
  for(let i=0;i<steps;i++){
    const t=(i/steps)*Math.PI*2;
    const x=centerX+scale*16*Math.pow(Math.sin(t),3);
    const y=centerY-scale*(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
    heartPoints.push({x,y});
  }
}

function initParticles() {
  particles=[];
  trails=[];
  for(let i=0;i<heartPoints.length;i++){
    const p=heartPoints[i];
    particles.push({
      x:p.x,
      y:p.y,
      size:Math.random()*2+1,
      color:settings.colorStart.slice(),
      sparkle: Math.random()<settings.sparkleChance
    });
    trails.push([]);
  }
}

function lerpColor(c1,c2,t){
  return c1.map((v,i)=>v+(c2[i]-v)*t);
}

function animate(){
  pulseTime+=settings.pulseSpeed;
  generateHeartShape();
  ctx.fillStyle="rgba(17,17,17,0.25)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  particles.forEach((p,i)=>{
    const target=heartPoints[i%heartPoints.length];
    const dx=target.x-p.x;
    const dy=target.y-p.y;
    p.x+=dx*0.1;
    p.y+=dy*0.1;

    const t=(Math.sin(pulseTime+i/100)+1)/2;
    const c=lerpColor(settings.colorStart,settings.colorEnd,t);
    p.color=`rgb(${Math.floor(c[0])},${Math.floor(c[1])},${Math.floor(c[2])})`;

    trails[i].push({x:p.x,y:p.y,size:p.size,color:p.color,sparkle:p.sparkle});
    if(trails[i].length>10) trails[i].shift();

    trails[i].forEach((t,j)=>{
      ctx.beginPath();
      ctx.arc(t.x,t.y,t.size*(j/10),0,Math.PI*2);
      ctx.fillStyle=t.color;
      ctx.globalAlpha=t.sparkle?Math.random():1;
      ctx.fill();
      ctx.globalAlpha=1;
    });

    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fillStyle=p.color;
    ctx.fill();
  });

  requestAnimationFrame(animate);
}

generateHeartShape();
initParticles();

setTimeout(()=>{
  document.getElementById('message').style.opacity=1;
},1000);

window.addEventListener('resize',()=>{
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
  centerX=canvas.width/2;
  centerY=canvas.height/2;
});

animate();
</script>
</body>
</html>
