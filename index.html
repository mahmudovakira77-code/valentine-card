<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Valentine Heart Explosion Ultra</title>
<style>
body {
  margin: 0;
  padding: 0;
  background: #111;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

#message {
  position: absolute;
  top: 50%;
  width: 100%;
  text-align: center;
  font-size: 36px;
  color: #ff7bac;
  opacity: 0;
  transform: translateY(-50%);
  letter-spacing: 2px;
  transition: opacity 2s;
}

canvas {
  display: block;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="message">С Днём Святого Валентина! ❤️ От Кира</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let heartX = canvas.width / 2;
let heartY = canvas.height / 2;
let heartBeat = 0;
let particles = [];
let trails = [];
let exploded = false;

// Функция для расчета точек сердца
function heartPoint(t) {
  return {
    x: 16 * Math.pow(Math.sin(t), 3),
    y: 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t)
  };
}

// Создаем 4500 частиц для плотного сердца
const NUM_PARTICLES = 4500;
for (let i = 0; i < NUM_PARTICLES; i++) {
  let t = Math.random() * Math.PI * 2;
  let p = heartPoint(t);
  particles.push({
    x: heartX + p.x * 15,
    y: heartY - p.y * 15,
    vx: 0,
    vy: 0,
    size: Math.random() * 2 + 1,
    color: "#ff4ca6",
    sparkle: Math.random() > 0.95 // редкое мерцание
  });
}

// Массив следов
for (let i = 0; i < NUM_PARTICLES; i++) {
  trails.push([]);
}

// Основная анимация
function animate() {
  ctx.fillStyle = "rgba(17,17,17,0.25)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  if (!exploded) {
    heartBeat += 0.05;
    let scale = 1 + 0.1 * Math.sin(heartBeat);

    particles.forEach(p => {
      let dx = p.x - heartX;
      let dy = p.y - heartY;
      ctx.beginPath();
      ctx.arc(heartX + dx*scale, heartY + dy*scale, p.size, 0, Math.PI*2);
      ctx.fillStyle = p.color;
      ctx.fill();
    });
  } else {
    particles.forEach((p, i) => {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.05; // гравитация
      p.vx *= 0.99;
      p.vy *= 0.99;

      // Добавляем в следы
      trails[i].push({x: p.x, y: p.y, size: p.size, color: p.color, sparkle: p.sparkle});
      if (trails[i].length > 12) trails[i].shift();

      // Рисуем следы
      trails[i].forEach((t, j) => {
        ctx.beginPath();
        ctx.arc(t.x, t.y, t.size * (j/12), 0, Math.PI*2);
        ctx.fillStyle = t.color;
        ctx.globalAlpha = t.sparkle ? Math.random() : 1;
        ctx.fill();
        ctx.globalAlpha = 1;
      });

      // Частица
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
      ctx.fillStyle = p.color;
      ctx.fill();
    });
  }

  requestAnimationFrame(animate);
}

// Взрыв сердца через 4 секунды
setTimeout(() => {
  exploded = true;
  particles.forEach(p => {
    let angle = Math.random() * Math.PI * 2;
    let speed = Math.random() * 15 + 2;
    p.vx = Math.cos(angle) * speed;
    p.vy = Math.sin(angle) * speed;
  });

  // Появление текста по буквам
  const msg = document.getElementById('message');
  msg.style.opacity = 1;
  const text = msg.innerText;
  msg.innerHTML = "";
  text.split("").forEach((c, i) => {
    setTimeout(() => { msg.innerHTML += c; }, i*50);
  });
}, 4000);

animate();

// Ресайз окна
window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  heartX = canvas.width / 2;
  heartY = canvas.height / 2;
});
</script>
</body>
</html>
